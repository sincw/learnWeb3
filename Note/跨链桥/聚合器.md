# 聚合器

如果说 BTC 是最成功的数字资产，那么以太坊则是最成功的智能合约平台。无论从资产规模，用户规模，还是生态规模上讲，以太坊无疑都是对 Dapp 的部署有最大吸引力的公链。Solidity 语言和 EVM 环境也成为区块链开发人员最习惯的开发工具。然而，以太坊的生态容纳量似乎已经达到瓶颈，交易缓慢、Gas 费高企成为阻碍其继续发展的核心限制因素。

尽管以太坊 2.0 的分片方案已经在计划中，但实际落地尚需时日，于是各种扩容方案先后被提出来，包括侧链、闪电网络、Plasma、Truebit，状态通道、Rollup。其中，侧链虽然可以解决扩容问题，但其安全性是独立负责的，不能继承以太坊的安全性，所以侧链被认为是一个新的 Layer1，其余的扩容方案则被认为是 Layer2。

为了行文简洁，后文将把 Layer1 和 Layer2 分别简写为 L1 和 L2。

L2 的实现形式历经演化，最后 Rollup 成为了主力的扩容技术。Rollup 方案在 L1 级别安全性、数据可用性、可扩展性，用户体验等方面的综合表现最好，以太坊生态的大多数的扩容网络都选择了采用 Rollup 方案构建。后文所称的 L2 ，将特指 Rollup 二层网络。

Rollup 的基本路线是将二层网络的状态转换信息全部提交到 L1 ，但同时通过提供有效性证明或者欺诈证明的方式，让 L1 可以实现**「懒惰验证」**（仅仅验证欺诈证明或有效性证明即可等效于验证 L2 提交的所有状态转换），从而节约 L1 的计算资源。

根据 Rollup 网络提交给 L1 的证明形式，Rollup 网络被分为两类，一类是通过挑战期生成欺诈证明的 Optimistic Rollup（ 后文简称 Op Rollup ） ，一类是采用零知识证明技术生成有效性证明的 Zk Rollup。讲述聚合器之间，我们需要先连接跨层快速资产桥。

### 为什么需要跨层快速资产桥

由于挑战期的存在，Op Rollup 有一个缺陷，那就是用户从 L2 向 L1 的提款周期较长，需要 7 天左右，ZK Rollup 则由于生成零知识证明的计算复杂度较大，用户提款时，也有大约 1 个小时左右的等待时间。然而，目前应用较广的是 Op Rollup ，因为 Op Rollup 对 EVM 的兼容较好，便于迁移 L1 Dapp，ZK Rollup 兼容EVM的难度较大，需要做大量的技术研究工作，目前尚未实现。另外，即使 ZK Rollup 未来成功做到兼容EVM，1 个小时左右的提款时间，对于没有耐心的用户也是无法接受的。用户期待的是：几分钟，甚至几秒钟！

除了快速提款之外，还有一个典型需求，那就是在 L2 与其他 L2 之间快速转账。常规的途径，是要先从 L2-1 提款到 L1 ，再从 L1 存入到目标 L2-2 ，但这样既缓慢，又不经济。

鉴于上述需求，不少提供 L2→L1 快速提款和 L2⇋L2 快速转账的跨层快速资产桥被开发出来。

### 跨层快速资产桥的技术本质

快速资产桥本身并没有加快原有的资产流转通道，而是另起炉灶，构建了一个新的资产流转通道。后文行文中，我们将分别称为**「原始通道」**和**「快速通道」**。

在快速通道中，增加了一个新角色，来为用户提供流动性垫付。**用户在源账本向流动性提供者付款，流动性提供者在目标账本上向用户的目标地址付款，然后，流通性提供者再通过原始通道，重新平衡自己的资产，实现流动性回归。**

跨层快速资产桥，除了支持 L2→L1 快速提款和 L2⇋L2 快速转账，往往也可以支持 L2 与其他 EVM 兼容链之间的快速转账，这是因为 EVM 兼容链往往与以太坊建立了桥接关系（包括成为以太坊的侧链），与L2之间，存在一条多跳的原始通道。

有些文献把跨层快速资产桥的流动性垫付模式归结为了一种新的跨链方案，并称之为「流动性互换」，但Paka Labs认为，在进行跨链技术类型归结时，还是应该关注其核心——信任机制。根据其信任机制，所有的跨层快速资产桥，基本可以落入两个框架内，一个是**原子交易模式**，一个是**见证人模式**。我们将分别介绍几个典型项目：

### 聚合、互操作

前文我们介绍了不同类型的跨层资产桥，那在实际操作中，我们如何选择合适的桥梁呢？我们需要一个工具，能够聚合所有的桥梁，并根据我们的实际需求进行匹配和推荐，这就是 FundMovR 在做的事情。

此外，上述所有跨层资产桥，都只实现了资产兑换的功能，没有实现对跨层互操作的支持。尽管见证人型跨层资产桥有实现跨层互操作的潜力，但尚且没有项目真正实现，DataMovR 正在这个方向布局。

FundMovR 和 DataMovR，都出自同一个项目—— MovR Network，二者是 MovR Network 的两个独立模块。聚合和互操作是跨层快速通道进阶演化的两个重要方向，MovR Network 准确的抓住了这两个方向，可以看出对于赛道的理解非常深刻。

#### 

##### 跨层快速资产桥聚合器

跨层资产桥已经足够多了，FundMovR 选择做一个聚合器，将各资产桥聚合起来，并为用户推荐最优路径。由于各跨层资产桥都只支持同质资产的兑换（例如，USDT只能兑换USDT，不能兑换其他资产），FundMovR 不光聚合了跨层资产桥，还聚合了各账本上的 Dex ，以便用户可以通过 FundMovR 直接完成异质资产的兑换。

假设 Alice 在 Arbitrum 上有 DAI，但她换成 Optimism 上的 ETH。她可以使用多种路径来实现：

- 路径一：通过 1inch on Arbitrum，把 DAI 换成 ETH ，然后通过Hop Exchange，把 ETH 从 Arbitrum 换到 Optimism ；

- 路径二：通过 Paraswap on Arbitrum，把 DAI 换成 ETH ，然后通过 Connext 将 ETH  从 Arbitrum 换到 Optimism；

- 路径三：通过 Hyphen，把 DAI 从 Arbitrum 换到 Optimism，然后通过 Uniswap on Optimism，把 DAI 换成 ETH ；

- 路径四：通过 cBridge，把 DAI 从 Arbitrum 换到 Optimism ，然后通过 Sushiswap on Optimism， 把 DAI 换成 ETH。

- 还有更多路径 ……

对于不同的需求，上述路径可能各有千秋。

假设兑换资金量很大，那么含有 AMM 机制的 Hyphen、Hop 会不可取，因为滑点会比较大，cBridge 会比较合适；

假设兑换资金量很小，Gas 将成为主要成本，为了节约 Gas，Hop Exchange 可能是更好的选择；

假设 Alice 对速度的要求是最优先的，那么采用中心化方式的 Hyphen 和 Degate Bridge 会更有优势；

至于 DEX 兑换环节，是在源账本 Arbitrum 上完成，还是在目标账本 Optimism 完成，取决于哪边流动性更大，滑点更低。

如果没有 FundMovR，上述权衡和考量，将由 Alice 自己完成。但通过 FundMovR ，系统会自动找到所有可用的路线，并分别以下面三条标准进行排序：

- 目标链上的最大输出

- 最低Gas费用

- 最短时间

Alice只需轻松的选择她喜欢的选项，剩下的就交给 FundMovR。

在有一定规模用户之后，FundMovR 还将推出**点对点结算层**，以实现更低成本的跨链交换。

假设 Alice 想将 100 DAI 从 Optimism 转移到 Arbitrum，而 Bob 想将 50 DAI 从 Arbitrum 转移到 Optimism。FundMovR 将相互清算 DAI，并将剩余的 50 个 DAI 从 Optimism 转移到 Arbitrum。

![](D:\Learn\web3\note\跨链桥\img\640%20(1).png)

图片源于MovR Network文档

对于跨层部署的Dapp，桥接功能是其必要组成部分。Dapp 开发人员希望构建内置的桥接器，为用户提供无缝的用户体验。**FundMovR 通过 SDK 和 API 使Dapp开发人员可以轻松集成FundMovR，以实现内置的效果，**例如，像 Aave、Instadapp 等 Dapp 可以轻松地允许用户从不同 L2 迁移用户抵押资金。

https://mp.weixin.qq.com/s/1BKXWhxXKOoyFkOaKfXBpg
